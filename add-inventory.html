<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Inventory</title>
  <link rel="stylesheet" href="add-inventory.css" />
  <!-- üÖ∞Ô∏è Google Fonts: Display Serif Font -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap" rel="stylesheet"/>
  <!-- üß± Google Icons: Outlined and Filled -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

</head>
<body>
  
  <main class="add-inventory-wrapper">

    <button id="toggle-controller" class="toggle-controller-btn" title="Show/Hide Controls" aria-label="Toggle Controls">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 9.5L12 3l9 6.5V20a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V9.5z"/>
        <path d="M9 22V12h6v10"/>
      </svg>
    </button>
    

    <div class="container sticky">
      <!-- üîπ Unified Sticky Header Control Bar -->
      <header class="stock-header sticky">
        <div class="top-controls">
          <!-- üîô Back Button to Dashboard -->
          <a href="dashboard.html" class="back-button">
            <i data-lucide="arrow-left" class="icon"></i> Back
          </a>
          <input type="text" id="input-to-search-inventory-item" placeholder="Scan barcode here..." autocomplete="off" />
        </div>
      </header>
      </div>
    </div>

    <section class="batch-section">
      <h2 id="current-batch-heading">Current Batch</h2>
      <div id="batch-items-container" class="batch-container">
        <!-- Items being added will be rendered here -->
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js" defer></script>
  <script src="initSupabase.js" defer></script>
  <script src="add-inventory.js" defer></script>

  <!-- üì¢ Toast + Loading Spinner Containers -->
  <div id="toast-container"></div>

  <!-- Modal Popup -->
    <!-- Modal to Confirm Item -->
    <div id="modalToConfirmItem" class="modal hidden">
      <div class="modal-content-confirmitem">
        
        <!-- Modal Title Header -->
        <div class="modal-header">
          Confirm Item
        </div>
    
        <!-- Scrollable Content Section -->
        <div class="modal-body-scrollable">
          <div id="modalItemInfo">
            <!-- Your dynamic item content will be injected here -->
          </div>
        </div>
    
        <!-- Button Footer -->
        <div id="modal-buttons-confirmitem">
          <button id="confirmAddItemBtn" class="confirm-btn">Confirm</button>
          <button id="cancelAddItemBtn" class="cancel-btn">Cancel</button>
        </div>
    
      </div>
    </div>

    <!-- Modal: Item Reached Batch Threshold -->
    <div id="modal-batch-threshold-reached" class="modal hidden">
      <div class="modal-content-batch-threshold">
        
        <!-- üè∑Ô∏è Item Preview (Title + Image) -->
        <div class="modal-batch-item-preview">
          <img id="batch-item-photo" src="" alt="Item Photo" class="modal-batch-photo" />
          <h2 id="batch-item-title" class="modal-batch-title">Item Name</h2>
        </div>

        <!-- üí¨ Instructions -->
        <div class="modal-body-batch-threshold">
          <p>This item has been scanned the maximum allowed times for this batch. Please perform a manual count</p>
          <p><strong>Scanned Count:</strong> <span id="scanned-count-display">‚Äî</span></p>

          <label for="input-manual-count">
            Enter Manual Count:
            <input type="number" id="input-manual-count" min="0" class="input-style-manual-count" placeholder="Enter confirmed quantity" />
          </label>

          <p id="manual-count-error-msg" class="manual-count-error hidden">
            ‚ùå The manual count does not match the scanned count. Please recount and try again.
          </p>
        </div>

        <!-- ‚úÖ Buttons -->
        <div class="modal-footer-batch-threshold">
          <button id="btn-confirm-manual-count" class="btn-batch-threshold-confirm">Confirm Count</button>
          <button id="btn-cancel-manual-count" class="btn-batch-threshold-close">Cancel</button>
        </div>

      </div>
    </div>

    <!-- Modal: Manual Count Mismatch -->
    <div id="modal-manual-count-mismatch" class="modal hidden">
      <div class="modal-content-manual-mismatch">
        <div class="modal-header-manual-mismatch">
          Mismatch Detected
        </div>

        <div class="modal-body-manual-mismatch">
          <p>The manual count does not match the scanned count.</p>
          <p>This item must be returned to the scanning station and rescanned from zero.</p>
        </div>

        <div class="modal-footer-manual-mismatch">
          <button id="btn-reset-count-to-zero" class="btn-mismatch-confirm-reset">OK ‚Äî Reset and Rescan</button>
        </div>
      </div>
    </div>

    <!-- Modal: Assign Location After Manual Count -->
    <div id="modal-assign-location" class="modal hidden">
      <div class="modal-content-assign-location">

        <!-- Modal Header -->
        <div class="modal-header-assign-location">
          Select Storage Location
        </div>

        <!-- Modal Body -->
        <div class="modal-body-assign-location">
          
          <!-- üîç Searchable Dropdown -->
          <label for="location-dropdown-search" class="location-label">Search or Select Location</label>
          <input
            type="text"
            id="location-dropdown-search"
            class="location-search-input"
            placeholder="Search location by name..."
            autocomplete="off"
          />

          <div id="location-dropdown-list" class="location-dropdown-list">
            <!-- Dropdown options will be populated dynamically -->
          </div>

          <!-- üì¶ Scan Location Barcode -->
          <label for="input-scan-location-barcode" class="location-label">
            Or Scan Location Barcode:
          </label>
          <input
            type="text"
            id="input-scan-location-barcode"
            class="location-scan-input"
            placeholder="Scan barcode here..."
            autocomplete="off"
          />

          <!-- üïò Last Used Location Info -->
          <div id="last-used-location-info" class="location-last-used">
            Last used location: <strong id="last-used-location-name">‚Äî</strong>
          </div>

        </div>

        <!-- Modal Footer -->
        <div class="modal-footer-assign-location">
          <button id="btn-confirm-location-assign" class="btn-location-confirm">Confirm Location</button>
          <button id="btn-cancel-location-assign" class="btn-location-cancel">Cancel</button>
        </div>

      </div>
    </div>

    <!-- Modal: add new location -->
    <div id="modal-add-location" class="modal hidden">
      <div class="modal-content-addlocation">
        <h2>Add New Location</h2>
    
        <form id="form-add-location" enctype="multipart/form-data">
          <!-- üìç Location Name -->
          <label for="location-name">Location Name</label>
          <input type="text" id="location-name" name="location_name" required />

          <!-- üè∑Ô∏è Location Type (Custom Dropdown with Create Option) -->
          <!-- üè∑Ô∏è Location Type -->
          <label for="location-type">Location Type</label>
          <div id="location-type-dropdown-container" class="custom-dropdown">
            <button id="location-type-dropdown-toggle" type="button" class="dropdown-toggle">
              Select Location Type
            </button>
            <div id="location-type-dropdown-menu" class="dropdown-menu"></div>
          </div>
          <input type="hidden" id="location-type" name="type" />


    
          <!-- üì¶ Location Barcode -->
          <label for="location-barcode">Barcode</label>
          <input type="text" id="location-barcode" name="location_barcode" readonly />

          <!-- üîò Manual Generate Button -->
          <button type="button" id="btn-generate-location-barcode" class="generate-barcode-btn">
            üîÑ Generate New Barcode
          </button>

          <!-- üñ® Barcode Preview -->
          <div class="barcode-preview-wrapper">
            <canvas id="barcode-canvas-location"></canvas>
          </div>

          <!-- üîó DYMO Label Preview Link -->
          <div id="dymo-link-preview" class="dymo-link-preview" style="margin-top: 12px;"></div>

    
          <!-- üßÆ Max Capacity (optional) -->
          <label for="location-capacity">Max Capacity</label>
          <input type="number" id="location-capacity" name="max_capacity" min="0" />
    
          <!-- üì∑ Upload Image -->
          <label for="location-photo">Photo</label>
          <input type="file" id="location-photo" name="photo" accept="image/*" />
    
          <!-- üìù Notes -->
          <label for="location-notes">Notes</label>
          <textarea id="location-notes" name="notes" rows="3"></textarea>
    
          <!-- Action Buttons -->
          <div class="modal-actions">
            <button type="submit" id="btn-submit-location">‚úÖ Add Location</button>
            <button type="button" id="btn-cancel-location">Cancel</button>
          </div>
        </form>
      </div>
    </div>
    



  <audio id="scan-sound" src="scan-ding.mp3" preload="auto"></audio>

  <!--initialize buttons-->
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    lucide.createIcons();
  </script>
</body>
</html>
